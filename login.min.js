/*! icbc wifi login - 2016-07-25 */
;function checkWifiStatus(b){var a=getcookie("cmp_glb_param");if(a==null||a==""){getNasInfo(function(c){if(c.result==0){alertLayer.open({content:"您当前可以正常上网，无需再次认证！是否跳转到首页？",btn:["好","取消"],yes:function(){window.location.href="index.html"}})}else{if(c.data.wlanuserip==""&&c.data.wlanuseripv6==""){alertLayer.open({content:"您当前未连接免费WIFI，此功能不能使用！",btn:["好"]})}else{b()}}})}else{b()}}window.ostype="pc";(function(){var c="pc";var b=navigator.userAgent.toLowerCase();if(/iphone|ipad/i.test(b)){c="ios"}else{if(/android/i.test(b)){c="android"}else{if(/linux/i.test(b)){c="android"}else{if(/windows/i.test(b)&&/phone/i.test(b)){c="windowsphone"}else{if(/symbian/i.test(b)){c="symbian"}else{c="pc"}}}}}window.ostype=c})();function sendClickData(b,a){getNasInfo(function(f){var c={username:f.data.username,userip:f.data.wlanuserip,useripv6:f.data.wlanuseripv6,usermac:f.data.wlanusermac,ostype:ostype,portalip:f.data.portalip,acname:f.data.wlanacname,acip:f.data.wlanacip,ssid:f.data.ssid,apmac:f.data.wlanapmac};for(var e in a){c[e]=a[e]}console.info(c);var d="/cmp/ilogserver_v2?method="+b;ajax({url:d,type:"POST",dataType:"json",data:c})})}var $GET={};var tmpParamPairs=document.location.search.slice(1).split("&");for(var i=0;i<tmpParamPairs.length;i++){var tmpPair=tmpParamPairs[i].split("=");$GET[tmpPair[0]]=decodeURIComponent(tmpPair[1])}window.$GET=$GET;var cookie_domain="";var cookie_path="/";function getcookie(d){var b=d+"=";var f=b.length;var a=document.cookie.length;var e=0;while(e<a){var c=e+f;if(document.cookie.substring(e,c)==b){return getcookieval(c)}e=document.cookie.indexOf(" ",e)+1;if(e==0){break}}return null}function getcookieval(b){var a=document.cookie.indexOf(";",b);if(a==-1){a=document.cookie.length}return unescape(document.cookie.substring(b,a))}function setcookie(d,e,c){var g=setcookie.arguments.length;var a=setcookie.arguments;var f=(g>5)?a[5]:false;var b=new Date();if(c==null||c==0){c=60}b.setTime(b.getTime()+3600000*24*c);document.cookie=d+"="+escape(e)+("; path="+cookie_path)+((cookie_domain=="")?"":("; domain="+cookie_domain))+((f==true)?"; secure":"")+";expires="+b.toGMTString()}function delcookie(a){var c=new Date();c.setTime(c.getTime()-1);var b=getcookie(a);document.cookie=a+"="+b+";expires="+c.toGMTString()}function utf16to8(j){var c,k,g,h;c="";g=j.length;for(k=0;k<g;k++){h=j.charCodeAt(k);if((h>=1)&&(h<=127)){c+=j.charAt(k)}else{if(h>2047){c+=String.fromCharCode(224|((h>>12)&15));c+=String.fromCharCode(128|((h>>6)&63));c+=String.fromCharCode(128|((h>>0)&63))}else{c+=String.fromCharCode(192|((h>>6)&31));c+=String.fromCharCode(128|((h>>0)&63))}}}return c}function utf8to16(m){var c,n,j,k;var o,l;c="";j=m.length;n=0;while(n<j){k=m.charCodeAt(n++);switch(k>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:c+=m.charAt(n-1);break;case 12:case 13:o=m.charCodeAt(n++);c+=String.fromCharCode(((k&31)<<6)|(o&63));break;case 14:o=m.charCodeAt(n++);l=m.charCodeAt(n++);c+=String.fromCharCode(((k&15)<<12)|((o&63)<<6)|((l&63)<<0));break}}return c}var base64EncodeChars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var base64DecodeChars=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);function base64encode(l){var h,n,k;var m,o,j;k=l.length;n=0;h="";while(n<k){m=l.charCodeAt(n++)&255;if(n==k){h+=base64EncodeChars.charAt(m>>2);h+=base64EncodeChars.charAt((m&3)<<4);h+="==";break}o=l.charCodeAt(n++);if(n==k){h+=base64EncodeChars.charAt(m>>2);h+=base64EncodeChars.charAt(((m&3)<<4)|((o&240)>>4));h+=base64EncodeChars.charAt((o&15)<<2);h+="=";break}j=l.charCodeAt(n++);h+=base64EncodeChars.charAt(m>>2);h+=base64EncodeChars.charAt(((m&3)<<4)|((o&240)>>4));h+=base64EncodeChars.charAt(((o&15)<<2)|((j&192)>>6));h+=base64EncodeChars.charAt(j&63)}return h}function base64decode(m){var n,o,q,k;var p,l,j;l=m.length;p=0;j="";while(p<l){do{n=base64DecodeChars[m.charCodeAt(p++)&255]}while(p<l&&n==-1);if(n==-1){break}do{o=base64DecodeChars[m.charCodeAt(p++)&255]}while(p<l&&o==-1);if(o==-1){break}j+=String.fromCharCode((n<<2)|((o&48)>>4));do{q=m.charCodeAt(p++)&255;if(q==61){return j}q=base64DecodeChars[q]}while(p<l&&q==-1);if(q==-1){break}j+=String.fromCharCode(((o&15)<<4)|((q&60)>>2));do{k=m.charCodeAt(p++)&255;if(k==61){return j}k=base64DecodeChars[k]}while(p<l&&k==-1);if(k==-1){break}j+=String.fromCharCode(((q&3)<<6)|k)}return j}function str_decode(b){return utf8to16(base64decode(b))}function str_encode(b){return base64encode(utf16to8(b))}(function(d,f){var e="1.0.0";var c=typeof undefined;var b=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;var j=function(k){return new j.fn.init(k)};j.trim=function(k){return k==null?"":(k+"").replace(b,"")};j.fn=j.prototype={version:e,constructor:j,selector:null};j.fn.on=function(m,l){var k=this.selector;if(k){if(k.addEventListener){k.addEventListener(m,l,false)}else{if(k.attachEvent){k.attachEvent("on"+m,l)}}}return this};var g=(/\S+/g);var a=/[\t\r\n\f]/g;j.fn.addClass=function(o){var m=(o||"").match(g)||[];var n=this.selector;if(n&&n.nodeType===1){var q=n.className?(" "+n.className+" ").replace(a," "):" ";if(q){var l=0;var k;while((k=m[l++])){if(q.indexOf(" "+k+" ")<0){q+=k+" "}}var p=j.trim(q);if(n.className!==p){n.className=p}}}return this};j.fn.removeClass=function(o){var m=(o||"").match(g)||[];var n=this.selector;if(n&&n.nodeType===1){var q=n.className?(" "+n.className+" ").replace(a," "):" ";if(q){var l=0;var k;while((k=m[l++])){while(q.indexOf(" "+k+" ")>=0){q=q.replace(" "+k+" "," ")}}var p=o?j.trim(q):"";if(n.className!==p){n.className=p}}}return this};j.fn.hasClass=function(k){var l=" "+k+" ";var m=this.selector;if(m&&m.nodeType===1&&(" "+m.className+" ").replace(a," ").indexOf(l)>=0){return true}return false};j.fn.val=function(l){var k=this.selector;if(k){if(!arguments.length){return k.value}else{k.value=l}}return this};j.fn.text=function(l){var k=this.selector;if(k){if(!arguments.length){return k.textContent}else{k.textContent=l}}return this};var h=j.fn.init=function(k){var l=f.getElementById(k);if(l){this.selector=l}return this};h.prototype=j.fn;d.$dom=j})(window,document);function ajax(b){function e(){var x,z;if(u){var w=[];if(typeof u==="string"){w=u.split("&");for(var y=0,v=w.length;y<v;y++){x=w[y].split("=")[0];z=w[y].split("=")[1];w[y]=encodeURIComponent(x)+"="+encodeURIComponent(z)}}else{if(typeof u==="object"){for(var x in u){var z=(u[x]||"").toString();x=encodeURIComponent(x);z=encodeURIComponent(z);w.push(x+"="+z)}}}w.push("ajaxRequest=true");u=w.join("&").replace("/%20/g","+");if(c==="get"||n==="jsonp"){f=f+(f.indexOf("?")>-1?"&":"?")+u}}}function a(v){if(window.JSON&&window.JSON.parse){return window.JSON.parse(v+"")}else{return(Function("return "+v))()}}function k(){var v=document.createElement("script"),w=new Date().getTime()+Math.round(Math.random()*1000),x="JSONP_"+w;window[x]=function(y){clearTimeout(d);document.body.removeChild(v);h(y)};v.src=f+(f.indexOf("?")>-1?"&":"?")+"callback="+x;v.type="text/javascript";document.body.appendChild(v);m(x,v)}function m(w,v){if(o!==undefined){d=setTimeout(function(){if(n==="jsonp"){delete window[w];document.body.removeChild(v)}else{t=true;j&&j.abort()}console.log("timeout")},o)}}function s(){function v(){if(window.XMLHttpRequest){return new XMLHttpRequest()}else{var w=["Microsoft","msxm3","msxml2","msxml1"];for(var y=0;y<w.length;y++){try{var x=w[y]+".XMLHTTP";return new ActiveXObject(x)}catch(z){}}}}j=v();j.open(c,f,g);if(c==="post"&&!r){j.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8")}else{if(r){j.setRequestHeader("Content-Type",r)}}j.setRequestHeader("X-Requested-With","XMLHttpRequest");j.onreadystatechange=function(){if(j.readyState===4){if(o!==undefined){if(t){return}clearTimeout(d)}if((j.status>=200&&j.status<300)||j.status==304){var w=j.responseText;if("json"==(""+n).toLowerCase()){w=a(w);var x=null;if(typeof(w.data)=="object"&&w.data.needJump){x=w.data.needJump}if(x!=null){window.location.href=decodeURIComponent(x);return}}h.call(j,w)}else{p(j.status,j.statusText)}}};j.send(c==="get"?null:u);m()}var q=function(){};var f=b.url||"",c=(b.type||"get").toLowerCase(),u=b.data||[],r=b.contentType||"",n=b.dataType||"",g=b.async===undefined&&true,o=b.timeOut,l=b.before||q,p=b.error||q,h=b.success||q;var t=false,d=null,j=null;e();l();if(n==="jsonp"){k()}else{s()}}!function(g,k){var m=k,j="querySelectorAll",e="getElementsByClassName",c=function(n){return m[j](n)};var a={type:0,shade:true,shadeClose:true,fixed:true,anim:true};var l={extend:function(p){var o=JSON.parse(JSON.stringify(a));for(var n in p){o[n]=p[n]}return o},timer:{},end:{}};l.touch=function(o,n){return o.addEventListener("click",function(p){n.call(this,p)},false)};var f=0,h=["layermbox"],b=function(n){var o=this;o.config=l.extend(n);o.view()};b.prototype.view=function(){var s=this,o=s.config,n=m.createElement("div");s.id=n.id=h[0]+f;n.setAttribute("class",h[0]+" "+h[0]+(o.type||0));n.setAttribute("index",f);var t=(function(){var v=typeof o.title==="object";return o.title?'<h3 style="'+(v?o.title[1]:"")+'">'+(v?o.title[0]:o.title)+'</h3><button class="layermend"></button>':""}());var p=(function(){var w=(o.btn||[]).length,v;if(w===0||!o.btn){return""}if(w===2){v='<span type="1" style="width:45%;">'+o.btn[0]+"</span>";v='<span type="0" style="width:45%;">'+o.btn[1]+"</span>"+v}else{v='<span type="1" style="width:90%;">'+o.btn[0]+"</span>"}return'<div class="layermbtn">'+v+"</div>"}());if(!o.fixed){o.top=o.hasOwnProperty("top")?o.top:100;o.style=o.style||"";o.style+=" top:"+(m.body.scrollTop+o.top)+"px"}if(o.type===2){o.content='<i></i><i class="laymloadtwo"></i><i></i>'}n.innerHTML=(o.shade?"<div "+(typeof o.shade==="string"?'style="'+o.shade+'"':"")+' class="laymshade"></div>':"")+'<div class="layermmain" '+(!o.fixed?'style="position:static;"':"")+'><div class="section"><div class="layermchild '+(o.className?o.className:"")+" "+((!o.type&&!o.shade)?"layermborder ":"")+(o.anim?"layermanim":"")+'" '+(o.style?'style="'+o.style+'"':"")+">"+t+'<div class="layermcont">'+o.content+"</div>"+p+"</div></div></div>";if(!o.type||o.type===2){var r=m[e](h[0]+o.type),u=r.length;if(u>=1){d.close(r[0].getAttribute("index"))}}k.body.appendChild(n);var q=s.elem=c("#"+s.id)[0];o.success&&o.success(q);s.index=f++;s.action(o,q)};b.prototype.action=function(o,p){var s=this;if(o.time){l.timer[s.index]=setTimeout(function(){d.close(s.index)},o.time*1000)}if(o.title){var q=p[e]("layermend")[0],w=function(){o.cancel&&o.cancel();d.close(s.index)};l.touch(q,w)}var n=function(){var x=this.getAttribute("type");if(x==0){o.no&&o.no();d.close(s.index)}else{o.yes?o.yes(s.index):d.close(s.index)}};if(o.btn){var r=p[e]("layermbtn")[0].children,u=r.length;for(var v=0;v<u;v++){l.touch(r[v],n)}}if(o.shade&&o.shadeClose){var t=p[e]("laymshade")[0];l.touch(t,function(){d.close(s.index,o.end)})}o.end&&(l.end[s.index]=o.end);g.setTimeout(function(){var x=c(".layermanim")[0];if(x){x.className=x.className.replace(" layermanim"," ")}},500)};var d={v:"1.7",index:f,open:function(n){m.body.style.overflow="hidden";var p=new b(n||{});return p.index},close:function(n){var o=c("#"+h[0]+n)[0];if(!o){return}o.innerHTML="";m.body.removeChild(o);m.body.style.overflow=null;clearTimeout(l.timer[n]);delete l.timer[n];typeof l.end[n]==="function"&&l.end[n]();delete l.end[n]},closeAll:function(){var o=m[e](h[0]);for(var p=0,n=o.length;p<n;p++){d.close((o[0].getAttribute("index")|0))}}};g.alertLayer=d}(window,document);var nasInfo=null;function getNasInfo(c){if(nasInfo){if(c){c(nasInfo)}return}var a={result:1,data:{username:"",wlanuserip:"",wlanuseripv6:"",wlanusermac:"",portalip:"",wlanacname:"",wlanacip:"",ssid:"",wlanapmac:""}};var b=5000;ajax({url:"http://nasgetinfo.com/portal/",type:"GET",dataType:"jsonp",timeout:b,success:function(d){nasInfo=d;if(c){c(nasInfo)}},error:function(){if(c){c(a)}}})}$dom("show_xieyi").on("click",function(){var a=document.getElementById("xieyi_layer").innerHTML;alertLayer.open({content:a,shadeClose:false,btn:["关闭"]})});var checkbox=$dom("xieyi-checkbox");var login_btn=$dom("login_btn");var sms_code_btn=$dom("get_code_buttom");checkbox.on("click",function(){var a=checkbox.hasClass("check");if(a){checkbox.removeClass("check");login_btn.removeClass("check")}else{checkbox.addClass("check");login_btn.addClass("check")}});login_btn.on("click",function(){window.scrollTo(0,0);checkWifiStatus(Login.doLogin)});sms_code_btn.on("click",function(){window.scrollTo(0,0);checkWifiStatus(Login.SendSms)});var Login={_time:null,_timeEvent:function(){Login.MaxTime--;if(Login.MaxTime<=0){window.clearInterval(Login._time);Login._time=null;sms_code_btn.removeClass("get_code2").addClass("get_code1").text("获取验证码")}else{sms_code_btn.removeClass("get_code1").addClass("get_code2").text(Login.MaxTime+"秒后重新获取")}},getMobile:function(){var b=/^1\d{10}$/g;var a=$dom.trim($dom("mobile").val());if(a==""){alertLayer.open({content:"请输入手机号码",shadeClose:false,btn:["好"]});return false}if(!b.test(a)){alertLayer.open({content:"请输入正确的手机号",shadeClose:false,btn:["好"]});return false}return a},MaxTime:60,SendSms:function(){var a=Login.getMobile();if(!Login._time&&a){Login.MaxTime=60;sms_code_btn.removeClass("get_code1").addClass("get_code2").text("短信发送中");ajax({url:"/cmp/TelAuthController.do?method=sendVerCode",type:"POST",data:{tel:a,tenantId:TENANT_ID},dataType:"json",timeout:60000,success:function(b){if(b.retCode!=0){alertLayer.open({content:""+b.msg+"",shadeClose:false,btn:["好"]});sms_code_btn.removeClass("get_code2").addClass("get_code1").text("获取验证码")}else{sendClickData("SMS_SEND",{username:a});if(!Login._time){Login._time=window.setInterval(Login._timeEvent,1000)}}},error:function(b,c,d){var f="短信发送失败，请重新点击获取";if(c=="timeout"){f="网络超时，请重新点击获取"}alertLayer.open({content:f,shadeClose:false,btn:["好"]});sms_code_btn.removeClass("get_code2").addClass("get_code1").text("获取验证码")}})}},isClick:false,doLogin:function(){if(Login.isClick===false){var a=Login.getMobile();if(!a){return false}var b=$dom.trim($dom("login_smscode").val());if(b==""){alertLayer.open({content:"请输入验证码",shadeClose:false,btn:["好"]});return false}b=base64encode(b);if(!checkbox.hasClass("check")){alertLayer.open({content:"请同意《无线上网服务使用协议》",shadeClose:false,btn:["好"]});return false}setcookie("layerSafeType","true",30);setcookie("layerPosterType","true",30);setcookie("layerNettimeType","true",30);Login.isClick=true;login_btn.removeClass("check");ajax({url:"/cmp/TelAuthController.do?method=auth",data:{tel:a,verCode:b,tenantId:TENANT_ID},dataType:"json",success:function(d){if(d.retCode==0){var c="index.html";if(typeof(d.data.nextPage)!="undefined"&&d.data.nextPage){c=d.data.nextPage}document.location.href=c;Login.isClick=false;checkbox.removeClass("check")}else{if(d.msg!=null&&d.msg!=""){alertLayer.open({content:""+d.msg+"",shadeClose:false,btn:["好"]})}else{alertLayer.open({content:"认证超时，请重试",shadeClose:false,btn:["好"]})}login_btn.addClass("check");Login.isClick=false}},error:function(){alertLayer.open({content:"认证超时，请重试",shadeClose:false,btn:["好"]});login_btn.addClass("check");Login.isClick=false}})}},init:function(){var a=$GET;if(a.oldMethod){if(a.oldTelphone){$dom("mobile").val(a.oldTelphone)}if(a.oldVerCode){$dom("login_smscode").val(a.oldVerCode)}if(a.oldMethod=="auth"){checkbox.addClass("check");login_btn.addClass("check");if(a.msg){alertLayer.open({content:""+a.msg+"",shadeClose:false,btn:["好"]})}}else{if(a.oldMethod=="sendVerCode"){if(a.msg){alertLayer.open({content:""+a.msg+"",shadeClose:false,btn:["好"]})}if(a.retCode!=undefined&&a.retCode=="0"){if(!Login._time){Login._time=window.setInterval(Login._timeEvent,1000)}}else{sms_code_btn.removeClass("get_code2").addClass("get_code1").text("获取验证码")}}}}}};Login.init();